name: Build

runs:
  using: "composite"
  
  steps:
    - name: Setup Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: "3.3.4"
    - name: Install bundled gems
      run: bundle install
      shell: bash
    - name: Build site
      env: # For the pull request preview action, sets it to an empty string when called by deploy
        path_prefix: ${{ github.event.number && format('/pr-preview/pr-{0}/', github.event.number) || '/'}}
      run: bundle exec middleman build --verbose
      shell: bash
    - name: Check HTML
      uses: anishathalye/proof-html@v2
      with:
        directory: ./build
        disable_external: true
        swap_urls: |
          {"^$path_prefix": "/"}